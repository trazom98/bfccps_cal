<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html> <head>
<title>BFCCPS Lunch Receipt Conversion For Google Calendar</title>

</head>

<body>
<script>
function convertToCsv() {
   var return_value = "Subject,Start Date, Start Time, End Date, End Time, All Day Event, Description, Location, Private";
   var input_value_raw = document.forms['conversion']['receipt'].value;
   var input_value = input_value_raw.split('\n');
   var namefound = false;
   var child = '';
   var date = '';
   var desc = '';
   var subj = '';
   var days_of_week = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
   
   for ( var i = 0, len = input_value.length; i < len; i++ )   {
        var row = input_value[i];
        if ( ! namefound ) {
           if (row.indexOf('registered') >= 0) {
               namefound = true;
               child = row.split(' ')[3];
           }
        }
        else {
            var words = row.split(' ');
            if ( days_of_week.includes( words[0])) {
                if ( desc != '' ) {
                    var nline = subj + "," + date + ",," + date + ",,True," + desc + ",BFCCPS,False";
                    return_value = return_value + "\n" + nline;
                }
                desc = "";
                subj = "";
                date = words[1];
            }
            else {
                if ( row == "" || row.indexOf( "Amount" ) > 0 ) {
                    var nline = subj + "," + date + ",," + date + ",,True," + desc + ",BFCCPS,False";
                    return_value = return_value + "\n" + nline;
                }
                else {
                   if ( words[0] == "-" ) {
                      if ( words[1] == "Lunch" || words[1] == "Breakfast" ) {
                          if( desc != "" ) {
                              var nline = subj + "," + date + ",," + date + ",,True," + desc + ",BFCCPS,False";
                              return_value = return_value + "\n" + nline;
                          }
                          subj = child + ": " + words[1];
                          desc = words.slice( 3, -1 ).join(" ");
                      }
                      else {
                         if ( row.indexOf( "Lunch" ) >= 0 ) {
                             subj = child + ": Lunch - Milk Only";
                             desc = words[7];
                         }
                      }
                  }
                }
            }
       }
        
    }
    document.forms['conversion']['csv_data'].value = return_value
}

function downloadCSV() {
    var textToWrite = document.forms['conversion']['csv_data'].value;
    var textFileAsBlob = new Blob([textToWrite], {type:'text/plain'});
    var fileNameToSaveAs = 'lunch_orders.csv';

    var downloadLink = document.createElement("a");
    downloadLink.download = fileNameToSaveAs;
    downloadLink.innerHTML = "Download File";
    if (window.webkitURL != null)
    {
        // Chrome allows the link to be clicked
        // without actually adding it to the DOM.
        downloadLink.href = window.webkitURL.createObjectURL(textFileAsBlob);
    }
    else
    {
        // Firefox requires the link to be added to the DOM
        // before it can be clicked.
        downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
        downloadLink.onclick = destroyClickedElement;
        downloadLink.style.display = "none";
        document.body.appendChild(downloadLink);
    }

    downloadLink.click();
}
</script>
<h1>BFCCPS Lunch Receipt Conversion - to CSV for import into Google Calendar</h1>

Instructions
<table width=900><tr><td>
<ol><li>Open the BFCCPS lunch order system, or your email and click on the receipt of
  order you want to use</li>
  <li>Highlight the text of the receipt from at least the line<br>
You have registered Jane Doe for: <br> and to the line with the <br>Total Amount: $XX.YY<img
  src="bfccps_famid.png" width=500 height=500></li>
  <li>Copy the highlighted text (control-C)</li>
  <li>Paste in to the copied text area below</li>
  <li>Click on Convert to CSV</li>
  <li>Click on Download as CSV to download it with the name
  "lunch_orders.csv" to your standard download location. <br>Alternately,
  copy everything in the Result text box and paste it into your
  favorite text editor and save as a csv.</li>
  <li>Open up <a href="http://calendar.google.com/ ">http://calendar.google.com/</a></li>
  <li>Go to the sprocket in upper right, click on Settings
  link</li>
  <li>Click on "Import & export" halfway down the page in the left hand menu</li>
  <li>Choose the file that was just downloaded, and the calendar you want to import it to</li>
  <li>Click import</li>
  <li>Your google calendar has all of the
  lunches</li></ol></td></tr></table>
  <p><p>
<form name="conversion">
<table><tr><td>Copied Text</td><td></td><td>Result</td></tr>
<tr><td>
<textarea name="receipt" style="height:400px;width:600px"
border=1></textarea></td>
<td><input type="button" value="Convert to CSV" onclick="convertToCsv()">
    <p>
    <input type="button" value="Download as CSV" onclick="downloadCSV()"></td>
<td><textarea name="csv_data" style="height:400px;width:600px"
  border=1></textarea></td></tr></table>
</form>

<hr>
   For limited help, contact <a href="mailto:ccourtright@gmail.com">Celia</a>.</body>
  </html>
